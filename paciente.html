<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Ficha completa do paciente CornÃ©lius">
  <title>CornÃ©lius | Paciente</title>
  <link rel="icon" type="image/png" href="assets/img/logo.cornelio.jpg">
  <link rel="stylesheet" href="assets/css/styles.css"/>
</head>
<body>
  <!-- ========== BARRA SUPERIOR ========== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">
          <img src="assets/img/logo.cornelio.jpg" alt="CornÃ©lius" class="brand-logo">
        </div>
        <div class="brand-title">
          <strong>CornÃ©lius</strong>
          <span>Paciente</span>
        </div>
      </div>

      <nav class="nav" role="navigation" aria-label="Menu principal">
        <a href="index.html">InÃ­cio</a>
        <a href="agenda.html">Agenda</a>
        <a href="cadastro.html">Cadastro</a>
        <a href="profissionais.html">Profissionais</a>
      </nav>
    </div>
  </div>

  <!-- ========== CONTEÃšDO PRINCIPAL ========== -->
  <main class="container">
    <!-- Header da pÃ¡gina -->
    <div class="header">
      <div>
        <h1 id="title">Paciente</h1>
        <p id="subtitle">Ficha completa do paciente.</p>
      </div>
      <div class="actions">
        <a class="btn" href="index.html">â† Voltar</a>
        <button class="btn" id="btnGoAgenda">Abrir agenda</button>
        <button class="btn primary" id="btnEdit">âœï¸ Editar dados</button>
      </div>
    </div>

    <!-- Tabs de navegaÃ§Ã£o -->
    <section class="card" style="padding:16px;">
      <div class="actions" style="justify-content:flex-start; gap: 8px;">
        <button class="btn primary" id="tabHistory">ğŸ“‹ HistÃ³rico</button>
        <button class="btn" id="tabAppointments">ğŸ“… Agendamentos</button>
        <button class="btn" id="tabFinance">ğŸ’° Financeiro</button>
        <button class="btn" id="tabFinanceSettings">âš™ï¸ Config. Financeira</button>
      </div>
    </section>

    <!-- Grid principal: conteÃºdo + sidebar -->
    <div class="grid">
      <!-- COLUNA ESQUERDA: ConteÃºdo das tabs -->
      <section class="card soft">

        <!-- ========== TAB: HISTÃ“RICO ========== -->
        <div id="panelHistory">
          <div class="card-title">
            <h2>HistÃ³rico de atendimentos</h2>
            <small>Atendimentos + anotaÃ§Ãµes</small>
          </div>

          <div class="actions" style="justify-content:flex-start; margin-bottom:14px;">
            <button class="btn primary" id="btnAddNote">+ Adicionar anotaÃ§Ã£o</button>
          </div>

          <div id="notesList" class="list"></div>
          
          <div id="notesEmpty" class="empty" style="display:none;">
            <p>ğŸ“ Nenhum registro de atendimento ainda.</p>
            <p><strong>Dica:</strong> Clique em "Adicionar anotaÃ§Ã£o" para criar o primeiro registro.</p>
          </div>
        </div>
<!-- ========== TAB: AGENDAMENTOS ========== -->
<div id="panelAppointments" style="display:none;">
  <div class="card-title">
    <h2>Agendamentos</h2>
    <small>Futuros e anteriores</small>
  </div>

  <div class="actions" style="justify-content:flex-start; margin-bottom:14px;">
  <button class="btn primary" id="btnSchedule">Agendar</button>
</div>


  <h3 style="margin: 8px 0 10px;">PrÃ³ximos</h3>
  <div id="apptsUpcomingList" class="list"></div>
  <div id="apptsUpcomingEmpty" class="empty" style="display:none;">
    <p>ğŸ“Œ Nenhum agendamento futuro.</p>
  </div>

  <h3 style="margin: 18px 0 10px;">Anteriores</h3>
  <div id="apptsPastList" class="list"></div>
  <div id="apptsPastEmpty" class="empty" style="display:none;">
    <p>ğŸ•˜ Nenhum agendamento anterior.</p>
  </div>
</div>

        <!-- ========== TAB: FINANCEIRO ========== -->
        <div id="panelFinance" style="display:none;">
          <div class="card-title">
            <h2>Controle financeiro</h2>
            <small>Pagamentos e pendÃªncias</small>
          </div>

          <!-- Cards de resumo financeiro -->
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-bottom:16px;">
            <div class="item" style="flex-direction: column; align-items: stretch;">
              <div class="meta">
                <strong style="color: var(--info);">Valor da consulta</strong>
                <span id="sumConsultation" style="font-size: 18px; font-weight: 700; color: var(--text);">-</span>
              </div>
            </div>
            <div class="item" style="flex-direction: column; align-items: stretch;">
              <div class="meta">
                <strong style="color: var(--success);">Total pago</strong>
                <span id="sumPaid" style="font-size: 18px; font-weight: 700; color: var(--text);">-</span>
              </div>
            </div>
            <div class="item" style="flex-direction: column; align-items: stretch;">
              <div class="meta">
                <strong style="color: var(--danger);">PendÃªncias</strong>
                <span id="sumPending" style="font-size: 18px; font-weight: 700; color: var(--text);">-</span>
              </div>
            </div>
          </div>

          <div class="actions" style="justify-content:flex-start; margin-bottom:14px;">
            <button class="btn primary" id="btnAddPayment">+ Registrar pagamento</button>
          </div>

          <div id="paymentsList" class="list"></div>
          
          <div id="paymentsEmpty" class="empty" style="display:none;">
            <p>ğŸ’³ Nenhum pagamento registrado ainda.</p>
          </div>
        </div>

        <!-- ========== TAB: CONFIG FINANCEIRA ========== -->
        <div id="panelFinanceSettings" style="display:none;">
          <div class="card-title">
            <h2>ConfiguraÃ§Ãµes financeiras</h2>
            <small>Valor padrÃ£o por paciente</small>
          </div>

          <div class="field">
            <label for="cfgConsultationValue">Valor padrÃ£o da consulta (R$)</label>
            <input 
              id="cfgConsultationValue" 
              type="number" 
              min="0" 
              step="0.01" 
              placeholder="Ex.: 180.00"
            />
          </div>

          <div class="field">
            <label for="cfgFinancialNote">ObservaÃ§Ãµes financeiras</label>
            <textarea 
              id="cfgFinancialNote" 
              placeholder="Ex.: valor social, pacote de sessÃµes, desconto especial, convÃªnio, etc."
              style="min-height: 120px;"
            ></textarea>
          </div>

          <div class="actions" style="justify-content:flex-start;">
            <button class="btn primary" id="btnSaveFinanceSettings">ğŸ’¾ Salvar configuraÃ§Ãµes</button>
          </div>

          <div class="empty" style="margin-top:16px;">
            ğŸ’¡ <strong>Dica:</strong> Esse valor serve como referÃªncia e preencherÃ¡ automaticamente o campo de valor ao registrar um novo pagamento.
          </div>
        </div>
      </section>

      <!-- COLUNA DIREITA: Dados bÃ¡sicos do paciente -->
      <aside class="card">
        <div class="card-title">
          <h2>Dados cadastrais</h2>
          <small>InformaÃ§Ãµes bÃ¡sicas</small>
        </div>

        <div style="display:flex; gap:10px; align-items:center; margin-bottom:14px;">
          <span class="pill">
            <span class="dot" id="colorDot"></span>
            Cor do paciente
          </span>
        </div>

        <div id="patientFields" class="list"></div>

        <div class="empty" style="margin-top:16px;">
           â„¹ï¸ InformaÃ§Ãµes do sistema
Os dados exibidos nesta tela sÃ£o armazenados de forma segura e vinculados ao paciente no sistema.
        </div>
      </aside>
    </div>

    <!-- ========== MODAL: ANOTAÃ‡ÃƒO ========== -->
    <div class="modal-backdrop" id="noteBackdrop" role="dialog" aria-modal="true">
      <div class="modal">
        <header>
          <h3>Nova anotaÃ§Ã£o</h3>
          <button class="close-x" id="btnCloseNote" aria-label="Fechar">Ã—</button>
        </header>

        <div class="body">
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="noteProfessional">Profissional</label>
              <select id="noteProfessional"></select>
            </div>
            <div class="field">
              <label for="noteLinkAppt">Vincular a atendimento</label>
              <select id="noteLinkAppt">
                <option value="">Nenhum</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label for="noteWhen">Data/hora do registro</label>
            <input id="noteWhen" type="datetime-local"/>
          </div>
          
          <div class="field">
            <label for="noteText">AnotaÃ§Ã£o clÃ­nica</label>
            <textarea 
              id="noteText" 
              placeholder="Descreva observaÃ§Ãµes sobre o atendimento, evoluÃ§Ã£o do paciente, etc."
              style="min-height: 140px;"
            ></textarea>
          </div>
        </div>

        <footer>
          <div class="actions" style="justify-content:flex-start;">
            <button class="btn danger" id="btnDeleteNote" style="display:none;">ğŸ—‘ï¸ Excluir</button>
          </div>
          <div class="actions">
            <button class="btn" id="btnCancelNote">Cancelar</button>
            <button class="btn primary" id="btnSaveNote">ğŸ’¾ Salvar anotaÃ§Ã£o</button>
          </div>
        </footer>
      </div>
    </div>

    <!-- ========== MODAL: PAGAMENTO ========== -->
    <div class="modal-backdrop" id="payBackdrop" role="dialog" aria-modal="true">
      <div class="modal">
        <header>
          <h3>Registrar pagamento</h3>
          <button class="close-x" id="btnClosePay" aria-label="Fechar">Ã—</button>
        </header>

        <div class="body">
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="payProfessional">Profissional</label>
              <select id="payProfessional"></select>
            </div>
            <div class="field">
              <label for="payLinkAppt">Vincular a atendimento</label>
              <select id="payLinkAppt">
                <option value="">Nenhum</option>
              </select>
            </div>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="payAmount">Valor (R$)</label>
              <input id="payAmount" type="number" min="0" step="0.01" placeholder="0.00"/>
            </div>
            <div class="field">
              <label for="payDate">Data/hora</label>
              <input id="payDate" type="datetime-local"/>
            </div>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="payStatus">Status do pagamento</label>
              <select id="payStatus">
                <option value="PAID">âœ… Pago</option>
                <option value="PENDING">â³ Pendente</option>
                <option value="PARTIAL">ğŸ“Š Parcial</option>
                <option value="FREE">ğŸ Isento</option>
              </select>
            </div>
            <div class="field">
              <label for="payMethod">Forma de pagamento</label>
              <select id="payMethod">
                <option value="PIX">ğŸ“± Pix</option>
                <option value="CARD">ğŸ’³ CartÃ£o</option>
                <option value="CASH">ğŸ’µ Dinheiro</option>
                <option value="TRANSFER">ğŸ¦ TransferÃªncia</option>
                <option value="OTHER">â• Outros</option>
              </select>
            </div>
          </div>

          <!-- SeÃ§Ã£o especÃ­fica para cartÃ£o -->
          <div id="cardBox" style="display:none; margin-top: 12px; padding-top: 12px; border-top: 1.5px dashed var(--border);">
            <h4 style="font-size: 14px; margin-bottom: 12px; color: var(--muted);">ğŸ’³ Detalhes do cartÃ£o</h4>
            
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
              <div class="field">
                <label for="cardType">Tipo de cartÃ£o</label>
                <select id="cardType">
                  <option value="CREDIT">CrÃ©dito</option>
                  <option value="DEBIT">DÃ©bito</option>
                </select>
              </div>
              <div class="field">
                <label for="cardBrand">Bandeira</label>
                <select id="cardBrand">
                  <option value="VISA">Visa</option>
                  <option value="MASTERCARD">Mastercard</option>
                  <option value="ELO">Elo</option>
                  <option value="AMEX">Amex</option>
                  <option value="HIPERCARD">Hipercard</option>
                  <option value="OTHER">Outros</option>
                </select>
              </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
              <div class="field">
                <label for="cardInstallments">Parcelas</label>
                <select id="cardInstallments"></select>
              </div>
              <div class="field">
                <label for="cardInstallmentValue">Valor por parcela</label>
                <input id="cardInstallmentValue" disabled />
              </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
              <div class="field">
                <label for="cardAuthorization">AutorizaÃ§Ã£o/NSU (opcional)</label>
                <input id="cardAuthorization" placeholder="Ex.: 123456"/>
              </div>
              <div class="field">
                <label for="cardFee">Taxa % (opcional)</label>
                <input id="cardFee" type="number" min="0" step="0.01" placeholder="Ex.: 3.2"/>
              </div>
            </div>

            <div class="empty" id="cardNetInfo" style="margin-top:12px;"></div>
          </div>

          <div class="field">
            <label for="payNote">ObservaÃ§Ãµes sobre o pagamento</label>
            <textarea 
              id="payNote" 
              placeholder="Ex.: pago na recepÃ§Ã£o, desconto aplicado, pacote de sessÃµes, etc."
              style="min-height: 80px;"
            ></textarea>
          </div>
        </div>

        <footer>
          <div class="actions" style="justify-content:flex-start;">
            <button class="btn danger" id="btnDeletePay" style="display:none;">ğŸ—‘ï¸ Excluir</button>
          </div>
          <div class="actions">
            <button class="btn" id="btnCancelPay">Cancelar</button>
            <button class="btn primary" id="btnSavePay">ğŸ’¾ Salvar pagamento</button>
          </div>
        </footer>
      </div>
    </div>

    <!-- ========== MODAL: EDITAR PACIENTE ========== -->
    <div class="modal-backdrop" id="editBackdrop" role="dialog" aria-modal="true">
      <div class="modal">
        <header>
          <h3>Editar dados do paciente</h3>
          <button class="close-x" id="btnCloseEdit" aria-label="Fechar">Ã—</button>
        </header>

        <div class="body">
          <div class="field">
            <label for="eName">Nome completo</label>
            <input id="eName" type="text" autocomplete="name"/>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="eCpf">CPF</label>
              <input id="eCpf" type="text"/>
            </div>
            <div class="field">
              <label for="eColor">Cor padrÃ£o</label>
              <select id="eColor">
                <option value="#457B9D">ğŸ”µ Azul</option>
                <option value="#2A9D8F">ğŸŸ¢ Verde</option>
                <option value="#9B5DE5">ğŸŸ£ Roxo</option>
                <option value="#F4A261">ğŸŸ  Laranja</option>
                <option value="#6C757D">âš« Cinza</option>
              </select>
            </div>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 14px;">
            <div class="field">
              <label for="eEmail">E-mail</label>
              <input id="eEmail" type="email" autocomplete="email"/>
            </div>
            <div class="field">
              <label for="ePhone">Telefone</label>
              <input id="ePhone" type="tel" autocomplete="tel"/>
            </div>
          </div>

          <div class="field">
            <label for="eAddress">EndereÃ§o completo</label>
            <input id="eAddress" type="text" autocomplete="street-address"/>
          </div>
        </div>

        <footer>
          <div class="actions">
            <button class="btn" id="btnCancelEdit">Cancelar</button>
            <button class="btn primary" id="btnSaveEdit">ğŸ’¾ Salvar alteraÃ§Ãµes</button>
          </div>
        </footer>
      </div>
    </div>
  </main>

  <!-- ========== SCRIPTS ========== -->

<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- ConfiguraÃ§Ã£o -->
<script src="assets/css/js/supabase-config.js"></script>

<!-- API -->
<script src="assets/css/js/supabase-api.js"></script>

<!-- Script da pÃ¡gina -->
<script src="assets/css/js/paciente.js"></script>
<script src="assets/css/js/auth.js"></script>
</body>
</html>