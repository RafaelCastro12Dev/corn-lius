<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Ficha completa do paciente Corn√©lius">
  <title>Corn√©lius | Paciente</title>
 <!-- √çcone para Android / Chrome -->


<!-- √çcone para iPhone / iOS -->
<link rel="apple-touch-icon" href="/assets/img/logo.cornelio.jpg">

<!-- For√ßa tela cheia no iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Biocare">

<!-- Cor da barra no Android -->
<meta name="theme-color" content="#ffffff">

  <link rel="icon" type="image/png" href="assets/img/logo.cornelio.jpg">
  <link rel="stylesheet" href="assets/css/styles.css"/>
</head>

<body>
  <!-- ========== BARRA SUPERIOR ========== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">
          <img src="assets/img/logo.cornelio.jpg" alt="Corn√©lius" class="brand-logo">
        </div>
        <div class="brand-title">
          <strong>Corn√©lius</strong>
          <span>Paciente</span>
        </div>
      </div>

      <nav class="nav">
        <a href="index.html"data-admin-only>In√≠cio</a>
        <a href="agenda.html"data-admin-only>Agenda</a>
        <a href="cadastro.html"data-admin-only>Cadastro</a>
        <a href="profissionais.html"data-admin-only>Profissionais</a>
        <a href="impressoes.html"data-admin-only>Impress√µes</a>
        <a href="#" id="btnLogout">Sair</a>


      </nav>
    </div>
  </div>

  <!-- ========== CONTE√öDO ========== -->
  <main class="container">

    <!-- Header -->
    <div class="header">
      <div>
        <h1 id="title">Paciente</h1>
        <p id="subtitle" style="margin:6px 0 0;">Ficha completa do paciente.</p>
      </div>

      <div class="actions">
        <button class="btn" id="btnSchedule" type="button">Agendar</button>
        <button class="btn primary" id="btnEdit" type="button">Editar dados</button>
      </div>
    </div>

    <div class="grid paciente-grid">
      <!-- Sidebar -->
      <aside class="card">
        <div style="display:flex; align-items:center; gap:10px;">
          <span id="colorDot" class="color-dot" style="width:14px;height:14px;"></span>
          <strong>Dados</strong>
        </div>
        <div id="patientFields" style="margin-top:12px;"></div>
      </aside>

      <!-- Conte√∫do -->
      <section class="card">

        <!-- Tabs -->
     <div class="tabs patient-tabs">

  <button class="btn primary" id="tabHistory">üìã Hist√≥rico</button>
  <button class="btn" id="tabAppointments">üóìÔ∏è Agendamentos</button>
  <button class="btn" id="tabFinance">üí∞ Financeiro</button>
  <button class="btn" id="tabFinanceSettings">‚öôÔ∏è Config. Financeira</button>

  <!-- ADMIN ONLY -->
  <div id="patientAdminPanel" class="patient-manage-wrap" style="display:none;">
    <div class="dropdown">
      <button type="button" class="btn-ghost" id="btnManagePatient">
        Gerenciar ‚ñæ
      </button>

      <div class="dropdown-menu" id="patientManageMenu" style="display:none;">
        <button type="button" class="dropdown-item" id="btnArchivePatient">
          Inativar paciente
          <small>Oculta das listas e bloqueia novos agendamentos.</small>
        </button>

        <button type="button" class="dropdown-item" id="btnRestorePatient" style="display:none;">
          Reativar paciente
          <small>Volta a aparecer nas listas.</small>
        </button>

        <div class="dropdown-sep"></div>

        <button type="button" class="dropdown-item danger" id="btnDeletePatient">
          Excluir permanentemente‚Ä¶
          <small>Somente se n√£o houver hist√≥rico.</small>
        </button>
      </div>
    </div>
  </div>

</div>

        <!-- PANEL: HIST√ìRICO -->
        <div id="panelHistory" style="margin-top:14px;">
          <div class="card-title">
            <h2>Hist√≥rico de atendimentos</h2>
            <small>Atendimentos + anota√ß√µes</small>
          </div>

          <div class="actions" style="margin-top:10px;">
            <button class="btn primary" id="btnAddNote" type="button">+ Adicionar anota√ß√£o</button>
          </div>

          <div id="notesEmpty" class="empty" style="display:none; margin-top:12px;">Nenhuma anota√ß√£o registrada.</div>
          <div id="notesList" class="list" style="margin-top:12px;"></div>
        </div>

        <!-- PANEL: AGENDAMENTOS -->
        <div id="panelAppointments" style="display:none; margin-top:14px;">
          <div class="card-title">
            <h2>Agendamentos</h2>
            <small>Pr√≥ximos e passados</small>
          </div>

          <h3 style="margin:14px 0 8px;">Pr√≥ximos</h3>
          <div id="apptsUpcomingEmpty" class="empty" style="display:none;">Nenhum agendamento futuro.</div>
          <div id="apptsUpcomingList"></div>

          <h3 style="margin:18px 0 8px;">Passados</h3>
          <div id="apptsPastEmpty" class="empty" style="display:none;">Nenhum agendamento passado.</div>
          <div id="apptsPastList"></div>
        </div>

        <!-- PANEL: FINANCEIRO -->
        <div id="panelFinance" style="display:none; margin-top:14px;">
          <div class="card-title">
            <h2>Financeiro</h2>
            <small>Pagamentos e resumo</small>
          </div>

          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:12px;">
            <div class="card" style="padding:12px;">
              <div class="text-sm text-secondary">Valor consulta</div>
              <div style="font-size:18px; font-weight:700;" id="sumConsultation">-</div>
            </div>
            <div class="card" style="padding:12px;">
              <div class="text-sm text-secondary">Pago</div>
              <div style="font-size:18px; font-weight:700;" id="sumPaid">-</div>
            </div>
            <div class="card" style="padding:12px;">
              <div class="text-sm text-secondary">Pendente</div>
              <div style="font-size:18px; font-weight:700;" id="sumPending">-</div>
            </div>
          </div>

          <div class="actions" style="margin-top:12px;">
            <button class="btn primary" id="btnAddPayment" type="button">+ Adicionar pagamento</button>
          </div>

          <div id="paymentsEmpty" class="empty" style="display:none; margin-top:12px;">Nenhum pagamento registrado.</div>
          <div id="paymentsList" class="list" style="margin-top:12px;"></div>
        </div>

        <!-- PANEL: CONFIG FINANCEIRA -->
        <div id="panelFinanceSettings" style="display:none; margin-top:14px;">
          <div class="card-title">
            <h2>Configura√ß√µes financeiras</h2>
            <small>Valores padr√£o e observa√ß√µes</small>
          </div>

          <div class="grid" style="grid-template-columns: 1fr; gap:12px; margin-top:12px;">
            <div>
              <label class="label" for="cfgConsultationValue">Valor da consulta</label>
              <input class="input" id="cfgConsultationValue" type="number" step="0.01" placeholder="Ex.: 120.00">
            </div>

            <div>
              <label class="label" for="cfgFinancialNote">Observa√ß√£o financeira</label>
              <textarea class="input" id="cfgFinancialNote" rows="4" placeholder="Ex.: Paciente em pacote, observa√ß√µes..."></textarea>
            </div>
          </div>

          <div class="actions" style="margin-top:12px;">
            <button class="btn primary" id="btnSaveFinanceSettings" type="button">Salvar</button>
            
          </div>
          
        </div>
        
      </section>
      
    </div>

    <!-- ========== MODAL: ANOTA√á√ÉO ========== -->
    <div class="modal-backdrop" id="noteBackdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <header>
          <h3>Nova anota√ß√£o</h3>
          <button class="close-x" id="btnCloseNote" type="button" aria-label="Fechar">√ó</button>
        </header>

        <form id="noteForm" autocomplete="on">
          <div class="body">
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
              <div>
                <label class="label" for="noteProfessional">Profissional</label>
                <select class="input" id="noteProfessional"></select>
              </div>

              <div>
                <label class="label" for="noteLinkAppt">Vincular a atendimento</label>
                <select class="input" id="noteLinkAppt"></select>
              </div>
            </div>

            <div style="margin-top:12px;">
              <label class="label" for="noteWhen">Data/hora do registro</label>
              <input class="input" id="noteWhen" type="datetime-local">
            </div>

            <div style="margin-top:12px;">
              <label class="label" for="noteText">Anota√ß√£o cl√≠nica</label>
              <textarea class="input" id="noteText" rows="8" placeholder="Digite a anota√ß√£o..."></textarea>
            </div>
          </div>

          <footer>
            <div class="actions" style="justify-content:flex-start;">
              <button class="btn danger" id="btnDeleteNote" type="button" style="display:none;">üóë Excluir</button>
            </div>
            <div class="actions">
              <button class="btn" id="btnCancelNote" type="button">Cancelar</button>
              <button class="btn primary" id="btnSaveNote" type="submit">üíæ Salvar anota√ß√£o</button>
            </div>
          </footer>
        </form>
      </div>
    </div>

    <!-- ========== MODAL: PAGAMENTO ========== -->
    <div class="modal-backdrop" id="payBackdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <header>
          <h3>Novo pagamento</h3>
          <button class="close-x" id="btnClosePay" type="button" aria-label="Fechar">√ó</button>
        </header>

        <form id="payForm" autocomplete="on">
          <div class="body">
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
              <div>
                <label class="label" for="payProfessional">Profissional</label>
                <select class="input" id="payProfessional"></select>
              </div>

              <div>
                <label class="label" for="payLinkAppt">Vincular a atendimento</label>
                <select class="input" id="payLinkAppt"></select>
              </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
              <div>
                <label class="label" for="payAmount">Valor</label>
                <input class="input" id="payAmount" type="number" step="0.01" placeholder="Ex.: 120.00">
              </div>

              <div>
                <label class="label" for="payDate">Data/hora</label>
                <input class="input" id="payDate" type="datetime-local">
              </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
              <div>
                <label class="label" for="payStatus">Status</label>
                <select class="input" id="payStatus">
                  <option value="PENDING">Pendente</option>
                  <option value="PAID">Pago</option>
                  <option value="PARTIAL">Parcial</option>
                  <option value="FREE">Isento</option>
                </select>
              </div>

              <div>
                <label class="label" for="payMethod">M√©todo</label>
                <select class="input" id="payMethod">
                  <option value="PIX">Pix</option>
                  <option value="CARD">Cart√£o</option>
                  <option value="CASH">Dinheiro</option>
                  <option value="TRANSFER">Transfer√™ncia</option>
                  <option value="OTHER">Outro</option>
                </select>
              </div>
            </div>

            <div style="margin-top:12px;">
              <label class="label" for="payNote">Observa√ß√£o</label>
              <textarea class="input" id="payNote" rows="4" placeholder="Opcional..."></textarea>
            </div>

            <!-- Cart√£o (opcional) -->
            <div id="cardBox" style="display:none; margin-top:14px;">
              <div class="card" style="padding:12px;">
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
                  <div>
                    <label class="label" for="cardType">Tipo</label>
                    <select class="input" id="cardType">
                      <option value="CREDIT">Cr√©dito</option>
                      <option value="DEBIT">D√©bito</option>
                    </select>
                  </div>
                  <div>
                    <label class="label" for="cardBrand">Bandeira</label>
                    <select class="input" id="cardBrand">
                      <option value="VISA">Visa</option>
                      <option value="MASTERCARD">Mastercard</option>
                      <option value="ELO">Elo</option>
                      <option value="AMEX">Amex</option>
                      <option value="OTHER">Outra</option>
                    </select>
                  </div>
                </div>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
                  <div>
                    <label class="label" for="cardInstallments">Parcelas</label>
                    <select class="input" id="cardInstallments"></select>
                  </div>
                  <div>
                    <label class="label" for="cardInstallmentValue">Valor parcela (auto)</label>
                    <input class="input" id="cardInstallmentValue" readonly>
                  </div>
                </div>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
                  <div>
                    <label class="label" for="cardAuthorization">NSU/Autoriza√ß√£o</label>
                    <input class="input" id="cardAuthorization" placeholder="Opcional">
                  </div>
                  <div>
                    <label class="label" for="cardFee">Taxa (%)</label>
                    <input class="input" id="cardFee" type="number" step="0.01" placeholder="Ex.: 3.20">
                  </div>
                </div>

                <div id="cardNetInfo" class="empty" style="margin-top:10px;"></div>
              </div>
            </div>

          </div>

          <footer>
            <div class="actions" style="justify-content:flex-start;">
              <button class="btn danger" id="btnDeletePay" type="button" style="display:none;">üóë Excluir</button>
            </div>
            <div class="actions">
              <button class="btn" id="btnCancelPay" type="button">Cancelar</button>
              <button class="btn primary" id="btnSavePay" type="submit">üíæ Salvar pagamento</button>
            </div>
          </footer>
        </form>
      </div>
    </div>

    <!-- ========== MODAL: EDITAR PACIENTE ========== -->
    <div class="modal-backdrop" id="editBackdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <header>
          <h3>Editar paciente</h3>
          <button class="close-x" id="btnCloseEdit" type="button" aria-label="Fechar">√ó</button>
        </header>

        <form id="editForm" autocomplete="on">
          <div class="body">
            <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap:12px;">
  <div>
    <label class="label" for="eName">Nome</label>
    <input class="input" id="eName" placeholder="Nome completo">
  </div>
  <div>
    <label class="label" for="eCpf">CPF</label>
    <input class="input" id="eCpf" placeholder="000.000.000-00">
  </div>
  <div>
    <label class="label" for="eBirthDate">Nascimento</label>
    <input class="input" id="eBirthDate" type="date">
  </div>
</div>


            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;">
              <div>
                <label class="label" for="eEmail">E-mail</label>
                <input class="input" id="eEmail" type="email" placeholder="email@exemplo.com">
              </div>
              <div>
                <label class="label" for="ePhone">Telefone</label>
                <input class="input" id="ePhone" placeholder="(00) 00000-0000">
              </div>
            </div>

            <div style="margin-top:12px;">
              <label class="label" for="eAddress">Endere√ßo</label>
              <input class="input" id="eAddress" placeholder="Rua, n√∫mero, bairro, cidade - UF">
            </div>

           

          <footer>
            <div class="actions">
              <button class="btn" id="btnCancelEdit" type="button">Cancelar</button>
              <button class="btn primary" id="btnSaveEdit" type="submit">Salvar</button>
            </div>
          </footer>
        </form>
      </div>
    </div>

  </main>

  <!-- Scripts (ordem correta) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/css/js/supabase-config.js"></script>
  <script src="assets/css/js/realtime.js"></script>
  <script src="assets/css/js/supabase-api.js"></script>
  <script src="assets/css/js/auth.js"></script>
  <script src="assets/css/js/paciente.js"></script>
</body>
</html>